name: Test

on:
    pull_request:
        types: [opened, reopened, synchronize]
        branches:
            - main

jobs:
  createfile:
    name: Create process file
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: 1arp/create-a-file-action@0.4.5
        with:
          path: /home/runner/work/pim/pim
          isAbsolutePath: true
          file: 'process.yaml'
          content: |
            max_logs: 2
            only_store_errors: true
            process:
              - run:
                name: apt-update
                schedule: '@hourly'
                directory: /home/test/
                command: sudo apt update -y

              - run:
                name: python-version
                schedule: '0 * * * * *'
                command: python3 test.py

  bash-example:
    runs-on: ubuntu-latest
    needs: createfile
    steps:
      - name: Group of log lines
        run: |
            ls -all
            pwd

  testing:
    name: unit tests
    needs: createfile
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Go 1.21.2
        uses: actions/setup-go@v5
        with:
          go-version: 1.21.2
      - name: Run unit tests
        run: go test

  linter:
    name: linter check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-go@v5
        with:
          go-version: 1.21.2
      - name: golangci-lint
        uses: golangci/golangci-lint-action@v6
        with:
          version: v1.58
